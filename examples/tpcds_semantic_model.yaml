# TPC-DS Semantic Model Example
# This example demonstrates the OSI Core Metadata Spec using the TPC-DS benchmark schema
# TPC-DS is a decision support benchmark with a realistic retail business model

semantic_model:
  - name: tpcds_retail_model
    description: TPC-DS retail semantic model for sales and customer analytics
    ai_context:
      prompt: "Use this semantic model for retail analytics. It provides comprehensive sales, customer, product, and store data from the TPC-DS benchmark. The model supports time-based analysis, customer segmentation, product performance, and store operations metrics."

    logical_datasets:
      # Fact table: Store sales transactions
      - name: store_sales
        base_table: tpcds.public.store_sales
        unique_keys:
          - ss_item_sk
          - ss_ticket_number
        description: Fact table containing all store sales transactions
        ai_context:
          synonyms:
            - "sales transactions"
            - "store purchases"
            - "retail sales"
            - "POS data"
            - "point of sale"

        fields:
          - name: ss_sold_date_sk
            expr: ss_sold_date_sk
            description: Foreign key to date dimension
            ai_context:
              synonyms:
                - "sale date"
                - "transaction date"
                - "purchase date"

          - name: ss_item_sk
            expr: ss_item_sk
            description: Foreign key to item dimension
            ai_context:
              synonyms:
                - "product"
                - "item"
                - "SKU"
                - "product key"

          - name: ss_customer_sk
            expr: ss_customer_sk
            description: Foreign key to customer dimension
            ai_context:
              synonyms:
                - "customer"
                - "buyer"
                - "purchaser"

          - name: ss_store_sk
            expr: ss_store_sk
            description: Foreign key to store dimension
            ai_context:
              synonyms:
                - "store location"
                - "retail location"
                - "store"

          - name: ss_quantity
            expr: ss_quantity
            description: Quantity of items sold
            ai_context:
              synonyms:
                - "units sold"
                - "quantity purchased"
                - "item count"
                - "units"

          - name: ss_sales_price
            expr: ss_sales_price
            description: Sales price per unit
            ai_context:
              synonyms:
                - "unit price"
                - "price per item"
                - "item price"

          - name: ss_ext_sales_price
            expr: ss_ext_sales_price
            description: Extended sales price (quantity * price)
            ai_context:
              synonyms:
                - "total price"
                - "line item total"
                - "extended price"
                - "total amount"

          - name: ss_net_profit
            expr: ss_net_profit
            description: Net profit from the sale
            ai_context:
              synonyms:
                - "profit"
                - "margin"
                - "earnings"
                - "net earnings"

      # Dimension table: Date
      - name: date_dim
        base_table: tpcds.public.date_dim
        unique_keys:
          - d_date_sk
        description: Date dimension with calendar attributes
        ai_context:
          synonyms:
            - "calendar"
            - "dates"
            - "time periods"
            - "date table"

        fields:
          - name: d_date_sk
            expr: d_date_sk
            description: Surrogate key for date
            dimension:
              is_time: true

          - name: d_date
            expr: d_date
            description: Actual date value
            dimension:
              is_time: true
            ai_context:
              synonyms:
                - "calendar date"
                - "date"

          - name: d_year
            expr: d_year
            description: Year
            dimension:
              is_time: true
            ai_context:
              synonyms:
                - "year"
                - "calendar year"

          - name: d_quarter_name
            expr: d_quarter_name
            description: Quarter name (e.g., 2024Q1)
            dimension:
              is_time: true
            ai_context:
              synonyms:
                - "quarter"
                - "fiscal quarter"
                - "Q1, Q2, Q3, Q4"

          - name: d_month_name
            expr: d_month_name
            description: Month name
            dimension:
              is_time: true
            ai_context:
              synonyms:
                - "month"
                - "calendar month"

          - name: d_day_name
            expr: d_day_name
            description: Day of week name
            dimension:
              is_time: true
            ai_context:
              synonyms:
                - "weekday"
                - "day of week"
                - "day name"

      # Dimension table: Customer
      - name: customer
        base_table: tpcds.public.customer
        unique_keys:
          - c_customer_sk
        description: Customer dimension with demographic information
        ai_context:
          synonyms:
            - "customers"
            - "shoppers"
            - "buyers"
            - "consumer demographics"
            - "purchasers"

        fields:
          - name: c_customer_sk
            expr: c_customer_sk
            description: Surrogate key for customer

          - name: c_customer_id
            expr: c_customer_id
            description: Business key for customer
            ai_context:
              synonyms:
                - "customer ID"
                - "customer number"
                - "customer identifier"

          - name: c_first_name
            expr: c_first_name
            description: Customer first name

          - name: c_last_name
            expr: c_last_name
            description: Customer last name

          - name: c_birth_year
            expr: c_birth_year
            description: Customer birth year
            ai_context:
              synonyms:
                - "age"
                - "birth year"
                - "year of birth"

          - name: c_email_address
            expr: c_email_address
            description: Customer email address
            ai_context:
              synonyms:
                - "email"
                - "contact"
                - "email address"

          - name: customer_full_name
            expr: c_first_name || ' ' || c_last_name
            description: Customer full name (computed field)
            ai_context:
              synonyms:
                - "full name"
                - "customer name"
                - "name"

      # Dimension table: Item (Product)
      - name: item
        base_table: tpcds.public.item
        unique_keys:
          - i_item_sk
        description: Item/Product dimension with product attributes
        ai_context:
          synonyms:
            - "products"
            - "items"
            - "merchandise"
            - "SKUs"
            - "inventory"
            - "catalog"

        fields:
          - name: i_item_sk
            expr: i_item_sk
            description: Surrogate key for item

          - name: i_item_id
            expr: i_item_id
            description: Business key for item
            ai_context:
              synonyms:
                - "item ID"
                - "product ID"
                - "SKU"
                - "product code"

          - name: i_item_desc
            expr: i_item_desc
            description: Item description
            ai_context:
              synonyms:
                - "product description"
                - "item name"
                - "product name"

          - name: i_brand
            expr: i_brand
            description: Brand name
            ai_context:
              synonyms:
                - "brand"
                - "manufacturer"
                - "brand name"

          - name: i_category
            expr: i_category
            description: Item category
            ai_context:
              synonyms:
                - "product category"
                - "department"
                - "category"

          - name: i_class
            expr: i_class
            description: Item class
            ai_context:
              synonyms:
                - "product class"
                - "product type"
                - "class"

          - name: i_current_price
            expr: i_current_price
            description: Current price of the item
            ai_context:
              synonyms:
                - "price"
                - "MSRP"
                - "list price"
                - "current price"

      # Dimension table: Store
      - name: store
        base_table: tpcds.public.store
        unique_keys:
          - s_store_sk
        description: Store dimension with location and store attributes
        ai_context:
          synonyms:
            - "stores"
            - "retail locations"
            - "outlets"
            - "branches"
            - "locations"

        fields:
          - name: s_store_sk
            expr: s_store_sk
            description: Surrogate key for store

          - name: s_store_id
            expr: s_store_id
            description: Business key for store
            ai_context:
              synonyms:
                - "store ID"
                - "store number"
                - "location ID"

          - name: s_store_name
            expr: s_store_name
            description: Store name
            ai_context:
              synonyms:
                - "store name"
                - "location name"
                - "branch name"

          - name: s_number_employees
            expr: s_number_employees
            description: Number of employees at the store
            ai_context:
              synonyms:
                - "employee count"
                - "staff size"
                - "number of employees"

          - name: s_city
            expr: s_city
            description: City where store is located
            ai_context:
              synonyms:
                - "city"
                - "location"
                - "store city"

          - name: s_state
            expr: s_state
            description: State where store is located
            ai_context:
              synonyms:
                - "state"
                - "region"
                - "province"

          - name: s_zip
            expr: s_zip
            description: ZIP code of store location
            ai_context:
              synonyms:
                - "zip code"
                - "postal code"
                - "ZIP"

    # Relationships between logical datasets
    relationships:
      - name: store_sales_to_date
        from: store_sales
        to: date_dim
        from_column: ss_sold_date_sk
        to_column: d_date_sk
        ai_context:
          synonyms:
            - "sales date relationship"
            - "when sale occurred"

      - name: store_sales_to_customer
        from: store_sales
        to: customer
        from_column: ss_customer_sk
        to_column: c_customer_sk
        ai_context:
          synonyms:
            - "customer purchase relationship"
            - "who bought"
            - "purchaser relationship"

      - name: store_sales_to_item
        from: store_sales
        to: item
        from_column: ss_item_sk
        to_column: i_item_sk
        ai_context:
          synonyms:
            - "product sold relationship"
            - "what was sold"
            - "item purchase relationship"

      - name: store_sales_to_store
        from: store_sales
        to: store
        from_column: ss_store_sk
        to_column: s_store_sk
        ai_context:
          synonyms:
            - "store location relationship"
            - "where sale occurred"
            - "sales location relationship"

    # Semantic model-level metrics spanning multiple datasets
    metrics:
      - name: customer_lifetime_value
        expr:
          - dialect: ANSI_SQL
            expression: SUM(store_sales.ss_ext_sales_price) / COUNT(DISTINCT customer.c_customer_sk)
        description: Average lifetime sales value per customer
        ai_context:
          synonyms:
            - "CLV"
            - "LTV"
            - "customer value"
            - "lifetime revenue"
            - "customer worth"
            - "average customer value"

      - name: sales_by_brand
        expr:
          - dialect: ANSI_SQL
            expression: SUM(store_sales.ss_ext_sales_price)
        description: Total sales grouped by brand (requires grouping by item.i_brand)
        ai_context:
          synonyms:
            - "brand sales"
            - "brand performance"
            - "brand revenue"
            - "sales per brand"

      - name: year_over_year_growth
        expr:
          - dialect: ANSI_SQL
            expression: |
              (SUM(CASE WHEN date_dim.d_year = YEAR(CURRENT_DATE) THEN store_sales.ss_ext_sales_price ELSE 0 END) -
               SUM(CASE WHEN date_dim.d_year = YEAR(CURRENT_DATE) - 1 THEN store_sales.ss_ext_sales_price ELSE 0 END)) /
               NULLIF(SUM(CASE WHEN date_dim.d_year = YEAR(CURRENT_DATE) - 1 THEN store_sales.ss_ext_sales_price ELSE 0 END), 0) * 100
        description: Year-over-year sales growth percentage
        ai_context:
          synonyms:
            - "YoY growth"
            - "year over year"
            - "annual growth"
            - "sales growth"
            - "yearly growth"

      - name: store_sales_per_employee
        expr:
          - dialect: ANSI_SQL
            expression: SUM(store_sales.ss_ext_sales_price) / NULLIF(SUM(store.s_number_employees), 0)
        description: Sales per employee across stores
        ai_context:
          synonyms:
            - "employee productivity"
            - "sales per staff"
            - "efficiency metric"
            - "revenue per employee"

      - name: top_selling_categories
        expr:
          - dialect: ANSI_SQL
            expression: SUM(store_sales.ss_ext_sales_price)
        description: Total sales by product category (requires grouping by item.i_category)
        ai_context:
          synonyms:
            - "category sales"
            - "category performance"
            - "department sales"
            - "sales by category"

    custom_extensions:
      - vendor_name: SNOWFLAKE
        data: '{"custom_instructions": "TPCDS model", "question_categorization": "TPCDS"}'

      - vendor_name: DBT
        data: '{"project_name": "tpcds_analytics", "models_path": "models/semantic"}'
      
